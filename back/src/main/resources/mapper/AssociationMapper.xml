<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.heeexy.example.dao.AssociationDao">

  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from association
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <!--新增社团-->
  <insert id="insert" parameterType="com.alibaba.fastjson.JSONObject">
    insert into association ( name, details,simple_detail,user_id
      )
    values ( #{name}, #{details},#{simple_detail},#{user_id}
      )
  </insert>
  <!--获取社团数量-->
  <select id="countAssociation" resultType="Integer">
    SELECT count(0)
    FROM association a
    WHERE a.delete_status = '1' AND a.is_open='1'
  </select>
  <!--获取社团详情-->
  <select id="getAssociation" resultType="com.alibaba.fastjson.JSONObject">

    SELECT a.*,au.user_id
    FROM association a left join ass_users au on  a.id=au.assocation_id
    WHERE a.delete_status = 1 AND a.is_open=1 and au.delete_status=1 and au.user_type=1 and a.id=#{id}

  </select>
  <!--获取社团列表-->
  <select id="listAssociation" resultType="com.alibaba.fastjson.JSONObject">
    SELECT
       w.id ,w.name,w.details,w.activity_id,w.user_id,
       date_format(w.create_time, '%Y.%m.%d %T') create_time,
       date_format(w.update_time, '%Y.%m.%d %T') update_time,
       w.simple_detail,w.is_open,w.delete_status

    FROM association w
    WHERE w.delete_status = 1 AND w.is_open=1
    ORDER BY w.id DESC
    LIMIT #{offSet}, #{pageRow}
  </select>
  <!--更新社团信息-->
  <update id="updateAssociation" parameterType="com.alibaba.fastjson.JSONObject">
    UPDATE association
    SET
    name=#{name},
    details=#{details},
    simple_detail=#{simple_detail},
    delete_status=#{delete_status},
    user_id=#{user_id}
    WHERE id = #{id}
  </update>
  <insert id="updateAssUser" parameterType="com.alibaba.fastjson.JSONObject" >
    INSERT INTO ass_users (user_id,assocation_id,is_accept,user_type)
    VALUE (#{user_id},#{id},#{is_accept},#{user_type})
  </insert>
</mapper>